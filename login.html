<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connexion - Gouv QuÃ©nada</title>
  <style>
    * {
      margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    html, body {
      height: 100%;
      background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    body {
      padding: 0;
    }
    .container {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: stretch;
      width: 100vw;
      height: 100vh;
      gap: 1rem;
      padding: 1rem;
    }
    .login-container, .passport-container {
      background: rgba(0, 0, 0, 0.75);
      border-radius: 15px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.8);
      padding: 2rem 2.5rem;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #ffda00 transparent;
    }
    .login-container {
      flex: 1 1 350px;
      max-width: 450px;
    }
    .passport-container {
      flex: 2 1 700px;
      max-width: 900px;
      display: none; /* cachÃ©e au dÃ©part */
      position: relative;
    }
    .passport-container.show {
      display: flex;
    }
    h2 {
      margin-bottom: 1.5rem;
      text-align: center;
      font-weight: 700;
      letter-spacing: 2px;
      color: #ffda00;
      font-size: 2rem;
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 1rem;
    }
    input[type="text"],
    input[type="password"],
    input[type="number"] {
      width: 100%;
      padding: 0.7rem;
      margin-bottom: 1.5rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
    }
    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="number"]:focus {
      outline: none;
      box-shadow: 0 0 8px #ffda00;
    }
    .btn {
      width: 100%;
      background: #ffda00;
      color: #000;
      font-weight: 700;
      padding: 0.8rem;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1.1rem;
      box-shadow: 0 5px 15px rgba(255, 218, 0, 0.5);
      transition: all 0.3s ease;
    }
    .btn:hover {
      background: #f0c200;
      box-shadow: 0 8px 20px rgba(240, 194, 0, 0.8);
      transform: translateY(-3px);
    }
    .error-msg {
      background: #ff3b3b;
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
      text-align: center;
      font-weight: 700;
    }
    .back-link {
      margin-top: 1rem;
      text-align: center;
    }
    .back-link a {
      color: #ffda00;
      text-decoration: none;
      font-weight: 600;
    }
    .back-link a:hover {
      text-decoration: underline;
    }
    label.remember-label {
      font-weight: 500;
      font-size: 0.9rem;
      user-select: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 1.5rem;
      color: #ffda00;
    }

    /* Passeport container */
    #welcomeMsg {
      font-size: 2rem;
      font-weight: 700;
      color: #ffda00;
      margin-bottom: 2rem;
      opacity: 1;
      transition: opacity 1s ease;
      text-align: center;
    }

    #userInfo {
      opacity: 0;
      transition: opacity 1s ease;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    #userInfo p {
      margin: 0.2rem 0;
      font-size: 1.2rem;
    }

    .passport-image {
      width: 100%;
      max-width: 100%;
      height: auto;
      max-height: 80vh;
      margin-bottom: 1rem;
      border-radius: 15px;
      filter: blur(8px);
      transition: filter 0.5s ease;
      position: relative;
    }
    .lock-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 5rem;
      color: rgba(255, 255, 255, 0.8);
      pointer-events: none;
      user-select: none;
      z-index: 10;
    }
    .passport-unlocked .passport-image {
      filter: none;
    }
    .passport-unlocked .lock-overlay {
      display: none;
    }

    .nip-form {
      margin-bottom: 1rem;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .nip-form input {
      flex: 1;
      padding: 0.7rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
    }
    .nip-form button {
      width: 130px;
      padding: 0.7rem;
      border-radius: 8px;
      border: none;
      background: #ffda00;
      color: #000;
      font-weight: 700;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    .nip-form button:hover {
      background: #f0c200;
    }

    .download-btn {
      background: #00cc66;
      color: #fff;
      padding: 0.8rem 2rem;
      border: none;
      border-radius: 30px;
      font-weight: 700;
      cursor: pointer;
      font-size: 1.1rem;
      box-shadow: 0 5px 15px rgba(0, 204, 102, 0.7);
      display: none;
      margin-top: 1rem;
      transition: background 0.3s ease;
      align-self: center;
    }
    .download-btn:hover {
      background: #00994d;
    }

    /* Buttons below passport */
    .action-buttons {
      margin-top: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100%;
      max-width: 400px;
    }
    .action-buttons button {
      background: #007bff;
      border: none;
      padding: 0.9rem 1rem;
      border-radius: 30px;
      font-weight: 700;
      cursor: pointer;
      color: white;
      font-size: 1.1rem;
      box-shadow: 0 5px 15px rgba(0,123,255,0.5);
      transition: background 0.3s ease;
      width: 100%;
    }
    .action-buttons button:hover {
      background: #0056b3;
    }

    /* Scrollbar style */
    .login-container::-webkit-scrollbar,
    .passport-container::-webkit-scrollbar {
      width: 8px;
    }
    .login-container::-webkit-scrollbar-thumb,
    .passport-container::-webkit-scrollbar-thumb {
      background-color: #ffda00;
      border-radius: 4px;
    }

    /* Responsive mobile */
    @media (max-width: 900px) {
      .container {
        flex-direction: column;
        padding: 1rem;
        gap: 1.5rem;
      }
      .login-container, .passport-container {
        max-width: 100%;
        flex: unset;
        height: 60vh;
      }
      .passport-container {
        max-height: 70vh;
      }
      .passport-image {
        max-height: 50vh;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="login-container">
      <h2>Connexion</h2>
      <div class="error-msg" id="errorMsg">Identifiant ou mot de passe incorrect.</div>
      <form id="loginForm" onsubmit="return validateLogin(event)">
        <label for="username">Identifiant</label>
        <input type="text" id="username" name="username" placeholder="Ton identifiant" required />

        <label for="password">Mot de passe</label>
        <input type="password" id="password" name="password" placeholder="Ton mot de passe" required />

        <label class="remember-label">
          <input type="checkbox" id="rememberMe" />
          Se souvenir de moi
        </label>

        <button type="submit" class="btn">Se connecter</button>
      </form>
      <div class="back-link">
        <a href="index.html">&larr; Retour au site</a>
      </div>
    </div>

    <div class="passport-container" id="passportSection">

      <div id="welcomeMsg"></div>

      <div id="userInfo">
        <p id="fullname"></p>
        <p id="dob"></p>
      </div>

      <div style="position: relative; width: 100%;">
        <img src="pass.png" alt="Passeport" class="passport-image" id="passportImg" />
        <div class="lock-overlay" id="lockOverlay">ðŸ”’</div>
      </div>

      <form id="nipForm" class="nip-form" onsubmit="return validateNIP(event)">
        <input type="number" id="nipInput" placeholder="Entre ton NIP" required />
        <button type="submit">DÃ©verrouiller</button>
      </form>

      <button class="download-btn" id="downloadBtn" onclick="downloadPassport()">TÃ©lÃ©charger PDF</button>

      <div class="action-buttons">
        <button onclick="demanderNouveauPasseport()">Demander un nouveau passeport</button>
        <button onclick="changerInformation()">Changer une information</button>
      </div>
    </div>
  </div>

<script>
  const usersDB = [
    {
      username: 'roman',
      password: 'bouchard14',
      fullname: 'Roman Bouchard',
      dob: '2011-07-19',
      nip: '1234',
      passportPDF: 'passport-roman.pdf'
    },
    {
      username: 'marie',
      password: 'lajoie22',
      fullname: 'Marie Lajoie',
      dob: '2005-11-02',
      nip: '5678',
      passportPDF: 'passport-marie.pdf'
    }
  ];

  let currentUser = null;

  window.onload = () => {
    const sessionUser = localStorage.getItem('sessionUser');
    const sessionPass = localStorage.getItem('sessionPass');

    if (sessionUser && sessionPass) {
      const foundUser = usersDB.find(u => u.username === sessionUser && u.password === sessionPass);
      if(foundUser) {
        currentUser = foundUser;
        document.querySelector('.login-container').style.display = 'none';
        const passportSection = document.getElementById('passportSection');
        passportSection.classList.add('show');
        showWelcomeMessage(foundUser.username, foundUser.fullname, foundUser.dob);
        return;
      }
    }

    const rememberedUser = localStorage.getItem('rememberedUser');
    if (rememberedUser) {
      document.getElementById('username').value = rememberedUser;
      document.getElementById('rememberMe').checked = true;
    }
  };

  function validateLogin(e) {
    e.preventDefault();
    const user = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value.trim();
    const remember = document.getElementById('rememberMe').checked;
    const errorMsg = document.getElementById('errorMsg');

    const foundUser = usersDB.find(u => u.username === user && u.password === pass);

    if(foundUser) {
      errorMsg.style.display = 'none';
      currentUser = foundUser;

      if (remember) {
        localStorage.setItem('rememberedUser', user);
        localStorage.setItem('sessionUser', user);
        localStorage.setItem('sessionPass', pass);
      } else {
        localStorage.removeItem('rememberedUser');
        localStorage.removeItem('sessionUser');
        localStorage.removeItem('sessionPass');
      }

      document.querySelector('.login-container').style.display = 'none';
      const passportSection = document.getElementById('passportSection');
      passportSection.classList.add('show');

      showWelcomeMessage(foundUser.username, foundUser.fullname, foundUser.dob);
    } else {
      errorMsg.style.display = 'block';
    }
    return false;
  }

  function showWelcomeMessage(username, fullname, dob) {
    const welcomeMsg = document.getElementById('welcomeMsg');
    const userInfo = document.getElementById('userInfo');
    const fullnameElem = document.getElementById('fullname');
    const dobElem = document.getElementById('dob');

    userInfo.style.opacity = 0;
    welcomeMsg.style.opacity = 1;
    welcomeMsg.textContent = `Bonjour, ${username}.`;

    setTimeout(() => {
      welcomeMsg.style.opacity = 0;
      setTimeout(() => {
        fullnameElem.textContent = `Nom complet : ${fullname}`;
        dobElem.textContent = `Date de naissance : ${dob}`;
        userInfo.style.opacity = 1;
      }, 1000);
    }, 2000);

    resetPassportView();
  }

  function resetPassportView() {
    const passportImg = document.getElementById('passportImg');
    const lockOverlay = document.getElementById('lockOverlay');
    const downloadBtn = document.getElementById('downloadBtn');
    const nipInput = document.getElementById('nipInput');

    passportImg.classList.remove('passport-unlocked');
    passportImg.style.filter = 'blur(8px)';
    lockOverlay.style.display = 'block';
    downloadBtn.style.display = 'none';
    nipInput.value = '';
  }

  function validateNIP(e) {
    e.preventDefault();
    const nipInput = document.getElementById('nipInput');
    const nipValue = nipInput.value.trim();
    if(!currentUser) return;

    if(nipValue === currentUser.nip) {
      unlockPassport();
    } else {
      alert('NIP incorrect, essaie encore.');
    }
    return false;
  }

  function unlockPassport() {
    const passportImg = document.getElementById('passportImg');
    const lockOverlay = document.getElementById('lockOverlay');
    const downloadBtn = document.getElementById('downloadBtn');

    passportImg.style.filter = 'none';
    lockOverlay.style.display = 'none';
    downloadBtn.style.display = 'inline-block';
  }

  function downloadPassport() {
    const pdfName = currentUser.passportPDF;

    const pdfContent = `
      %PDF-1.4
      1 0 obj
      << /Type /Catalog /Pages 2 0 R >>
      endobj
      2 0 obj
      << /Type /Pages /Kids [3 0 R] /Count 1 >>
      endobj
      3 0 obj
      << /Type /Page /Parent 2 0 R /MediaBox [0 0 300 144] /Contents 4 0 R >>
      endobj
      4 0 obj
      << /Length 44 >>
      stream
      BT
      /F1 24 Tf
      50 100 Td
      (Passeport de ${currentUser.fullname}) Tj
      ET
      endstream
      endobj
      5 0 obj
      << /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>
      endobj
      xref
      0 6
      0000000000 65535 f 
      0000000010 00000 n 
      0000000061 00000 n 
      0000000116 00000 n 
      0000000211 00000 n 
      0000000323 00000 n 
      trailer
      << /Size 6 /Root 1 0 R >>
      startxref
      395
      %%EOF
    `;

    const blob = new Blob([pdfContent], {type: 'application/pdf'});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = pdfName;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function demanderNouveauPasseport() {
    alert('Fonction "Demander un nouveau passeport" Ã  venir. Patience, câ€™est en construction.');
  }

  function changerInformation() {
    alert('Fonction "Changer une information" Ã  venir. On travaille dessus, reste Ã  lâ€™Ã©coute.');
  }
</script>

</body>
</html>
